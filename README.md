# git-webui

A minimal aiohttp-based web interface for applying user-provided patches to GitHub repositories with `git apply --3way -v`, committing, and pushing the result.

## Features

- Clone a repository over SSH (or HTTPS) using a provided URL.
- Optional branch selection/creation.
- Configure git user name and email before committing by selecting from a predefined list.
- Choose an SSH private key path from a predefined list.
- Upload a patch via the browser and apply it with `git apply --3way -v`.
- Commit with a custom message and push the result, all while streaming detailed logs back to the UI for troubleshooting.

## Requirements

- Python 3.10+
- Dependencies listed in `requirements.txt`

Install dependencies:

```bash
pip install -r requirements.txt
```

## Usage

```bash
python backend/app.py
```

The backend listens on `http://0.0.0.0:8080/` by default.

Serve the static frontend separately (for example):

```bash
python -m http.server 8000 -d docs
```

Then open `http://localhost:8000` in your browser and set the backend URL (for example, `http://localhost:8080`) in the UI so it can connect and load configuration.

1. Enter the repository SSH URL (HTTPS is also supported when credentials are already configured).
2. Optionally specify a target branch. If the branch does not exist it will be created. You can also switch the branch creation mode to create a new branch from a commit ID or start an orphan branch.
3. Select a git user (name & email) from the configured list to apply to the cloned repository before committing.
4. Choose an SSH private key path from the configured list if pushing over SSH is required.
5. Paste the patch content (as generated by `git diff` or similar).
6. Enter a (potentially multi-line) commit message. If omitted the application will apply the patch but skip commit/push.
7. Submit the form to run the automated workflow. All git command outputs and errors appear in the log section so you can diagnose failures.

## Configuration

The application reads `config.toml` (or the path specified via the `GIT_WEBUI_CONFIG` environment variable) on startup. The file must define two array tables:

```toml
[[ssh_keys]]
label = "Example SSH Key"
path = "/home/user/.ssh/id_ed25519"
default = true

[[git_users]]
label = "Example User"
name = "Example User"
email = "user@example.com"
default = true
```

- `ssh_keys`: the path is used directly with `ssh -i`. The label is shown in the dropdown. Set `default = true` to preselect a key in the UI.
- `git_users`: the name/email pair is applied via `git config` when selected. Set `default = true` to preselect a user in the UI.

If either list is empty the corresponding dropdown shows that no options are available.

## Notes

- Repositories are cloned into a persistent workspace (default: `./repos`) and reused for subsequent requests; before applying new patches the app pulls the latest changes from the remote.
- Set `GIT_WEBUI_REPO_ROOT` to override the repository workspace location.
- Logs include timestamps (UTC) for each command and their outputs, helping identify at which step a failure occurred.
- The web UI does not persist any sensitive data such as SSH keys or patches, but it does store recently used repository/branch values and the backend URL in browser local storage.

## Prefilling the UI via URL query parameters

The frontend reads URL query parameters on load and uses them to prefill form inputs. This is handy for sharing a prepared link or for automation. After applying the values, the UI removes the query string from the browser address bar.

Supported parameters:

- `backend_url`
- `repository_url`
- `branch`
- `branch_mode` (`default`, `from_commit`, or `orphan`)
- `new_branch`
- `base_commit`
- `git_user`
- `commit_message`
- `allow_empty_commit` (`true`, `1`, `yes`, or `on`)
- `ssh_key_path`
- `patch`

Example:

```
http://localhost:8000/?repository_url=git@github.com:example/repo.git&branch=main&commit_message=Hello&allow_empty_commit=true
```
