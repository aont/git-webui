javascript:!async function(){const taskId=location.pathname.split(%22/%22).filter(Boolean).pop();const resultFindTask=function(obj,matcher){const visited=new WeakSet;return function dfs(node,path){if(null===node)return null;if(%22object%22!==typeof node)return null;if(%22function%22==typeof node)return null;const anyNode=node;if(visited.has(anyNode))return null;visited.add(anyNode);if(matcher(anyNode,path))return{parent:anyNode,path:path};if(Array.isArray(anyNode))for(let i=0;i<anyNode.length;i++){const hit=dfs(anyNode[i],path.concat(i));if(hit)return hit}else for(const[k,v]of Object.entries(anyNode)){const hit=dfs(v,path.concat(k));if(hit)return hit}return null}(obj,[])}(window,(parent,path)=>{if(!Object.prototype.hasOwnProperty.call(parent,%22task%22))return!1;const task=parent.task;return task&&task.id==taskId});if(!resultFindTask)throw new Error(%22No matching element found (taskId=%22+JSON.stringify(taskId)+%22).%22);const data=resultFindTask.parent;console.log({data:data});const branchName=data.current_assistant_turn.branch;const repoMapEntries=Object.entries(data.current_assistant_turn.environment.repo_map);if(1!=repoMapEntries.length)throw Error(%22repo_map has %22+repoMapEntries.length+%22 entrie(s). (expected: 1)%22);const repo=repoMapEntries[0][1].repository_full_name;const pr=data.current_assistant_turn.output_items.find((value,index,obj)=>{if(%22type%22in value){if(%22pr%22==value.type)return!0}return!1});const prMessage=%22#%20%22+pr.pr_title+%22\n\n%22+pr.pr_message;const%20patch=function(patchText,contextLines=3){if(!Number.isFinite(contextLines)||contextLines%3C0)throw%20new%20Error(%22contextLines%20must%20be%20a%20non-negative%20number%22);const%20lines=patchText.replace(/\r\n/g,%22\n%22).split(%22\n%22);const%20out=[];let%20i=0;const%20isHunkHeader=line=%3E/^@@\s+-(\d+)(?:,(\d+))?\s+\+(\d+)(?:,(\d+))?\s+@@/.test(line);const%20isFileHeaderStart=line=%3Eline.startsWith(%22diff%20--git%20%22);for(;i%3Clines.length;){const%20line=lines[i];if(!isHunkHeader(line)){out.push(line);i++;continue}const%20hunkHeader=parseHunkHeader(line);i++;const%20hunkBodyStart=i;for(;i%3Clines.length&&!isHunkHeader(lines[i])&&!isFileHeaderStart(lines[i]);)i++;const%20trimmedHunks=trimOneHunk(hunkHeader,lines.slice(hunkBodyStart,i),contextLines);for(const%20th%20of%20trimmedHunks){out.push(th.headerLine);out.push(...th.bodyLines)}}return%20out.reduce((acc,line)=%3Eacc+line+%22\n%22,%22%22);function%20parseHunkHeader(headerLine){const%20m=headerLine.match(/^@@\s+-(\d+)(?:,(\d+))?\s+\+(\d+)(?:,(\d+))?\s+@@(.*)$/);if(!m)throw%20new%20Error(%22Invalid%20hunk%20header:%20%22+headerLine);return{oldStart:parseInt(m[1],10),oldLen:null!=m[2]?parseInt(m[2],10):1,newStart:parseInt(m[3],10),newLen:null!=m[4]?parseInt(m[4],10):1,section:m[5]||%22%22,raw:headerLine}}function%20formatHunkHeader(oldStart,oldLen,newStart,newLen,section){const%20fmtRange=(start,len)=%3E1===len?%22%22+start:start+%22,%22+len;return%22@@%20-%22+(lenIsZero(oldLen)?oldStart+%22,0%22:fmtRange(oldStart,oldLen))+%22%20+%22+(lenIsZero(newLen)?newStart+%22,0%22:fmtRange(newStart,newLen))+%22%20@@%22+section}function%20lenIsZero(n){return%200===n}function%20classifyLine(l){if(l.startsWith(%22\\%20No%20newline%20at%20end%20of%20file%22))return{type:%22meta%22,text:l};const%20ch=l[0];return%22%20%22===ch?{type:%22ctx%22,text:l}:%22+%22===ch?{type:%22add%22,text:l}:%22-%22===ch?{type:%22del%22,text:l}:{type:%22other%22,text:l}}function%20trimOneHunk(hh,bodyLines,ctx){const%20items=bodyLines.map(classifyLine);const%20oldBefore=new%20Array(items.length+1);const%20newBefore=new%20Array(items.length+1);let%20o=hh.oldStart;let%20n=hh.newStart;oldBefore[0]=o;newBefore[0]=n;for(let%20idx=0;idx%3Citems.length;idx++){const%20it=items[idx];if(%22ctx%22===it.type){o+=1;n+=1}else%22del%22===it.type?o+=1:%22add%22===it.type&&(n+=1);oldBefore[idx+1]=o;newBefore[idx+1]=n}const%20changeIdxs=[];for(let%20idx=0;idx%3Citems.length;idx++){const%20t=items[idx].type;%22add%22!==t&&%22del%22!==t||changeIdxs.push(idx)}if(0===changeIdxs.length)return[];const%20ranges=[];let%20blockStart=changeIdxs[0];let%20blockEnd=changeIdxs[0];for(let%20k=1;k%3CchangeIdxs.length;k++){const%20idx=changeIdxs[k];if(idx===blockEnd+1)blockEnd=idx;else{ranges.push(expandBlock(blockStart,blockEnd,ctx));blockStart=idx;blockEnd=idx}}ranges.push(expandBlock(blockStart,blockEnd,ctx));ranges.sort((a,b)=%3Ea[0]-b[0]);const%20merged=[];for(const%20r%20of%20ranges)if(0===merged.length)merged.push(r);else{const%20last=merged[merged.length-1];r[0]%3C=last[1]+1?last[1]=Math.max(last[1],r[1]):merged.push(r)}const%20result=[];for(const[s,e]of%20merged){const%20segItems=items.slice(s,e+1);const%20segOldStart=oldBefore[s];const%20segNewStart=newBefore[s];let%20oldLen=0,newLen=0;for(const%20it%20of%20segItems)if(%22ctx%22===it.type){oldLen++;newLen++}else%22del%22===it.type?oldLen++:%22add%22===it.type&&newLen++;const%20headerLine=formatHunkHeader(segOldStart,oldLen,segNewStart,newLen,hh.section);const%20bodyOut=segItems.map(x=%3Ex.text);segItems.some(x=%3E%22add%22===x.type||%22del%22===x.type)&&result.push({headerLine:headerLine,bodyLines:bodyOut})}return%20result;function%20expandBlock(startIdx,endIdx,ctxN){let%20s=startIdx;let%20ctxCount=0;for(let%20j=startIdx-1;j%3E=0;j--){const%20t=items[j].type;if(%22ctx%22===t){ctxCount++;s=j;if(ctxCount%3E=ctxN)break}else%20if(%22meta%22===t||%22other%22===t)s=j;else{if(%22add%22===t||%22del%22===t)break;s=j}}let%20e=endIdx;ctxCount=0;for(let%20j=endIdx+1;j%3Citems.length;j++){const%20t=items[j].type;if(%22ctx%22===t){ctxCount++;e=j;if(ctxCount%3E=ctxN)break}else%20if(%22meta%22===t||%22other%22===t)e=j;else{if(%22add%22===t||%22del%22===t)break;e=j}}return[s,e]}}}(pr.output_diff.diff,5);console.log({repo:repo,branchName:branchName,prMessage:prMessage,patch:patch});const%20url=%22https://aont.github.io/git-webui/#?repository_url=%22+encodeURIComponent(%22git@github.com:%22+repo)+%22&branch=%22+encodeURIComponent(branchName)+%22&branch_mode=default&allow_empty_commit=false&new_branch=&base_commit=&pr_message=%22+encodeURIComponent(prMessage)+%22&patch=%22+encodeURIComponent(patch);console.log({url:url});const%20a=document.createElement(%22a%22);a.innerHTML=%22dummy%22;a.style.display=%22none%22;a.addEventListener(%22click%22,function(){window.open(url,%22_blank%22);return!1},{once:!0});document.body.appendChild(a);a.click();document.body.removeChild(a)}();
